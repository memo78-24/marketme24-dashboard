<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Market.Me24 â€” GINI you fly | Polished Interactive Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0e1320; --panel:#151b2d; --accent:#ff7a18; --text:#eaf0ff; --muted:#92a0c6;
      --blue:#3ec2ff; --green:#41d67a; --purple:#b071ff; --border:#213052;
      --card:#0f172a; --chip:#0f172a;
    }
    [data-theme="light"]{
      --bg:#f6f8ff; --panel:#ffffff; --accent:#ff7a18; --text:#101422; --muted:#5b6a8b;
      --blue:#1073ff; --green:#0aa068; --purple:#7a4cff; --border:#e3e8f4;
      --card:#f2f6ff; --chip:#eef3ff;
    }
    *{box-sizing:border-box;}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:linear-gradient(180deg,var(--bg) 0%, var(--bg) 100%); color:var(--text);
      transition: background .25s ease, color .25s ease;
    }
    header{
      display:flex; align-items:center; justify-content:space-between;
      padding:18px 22px; border-bottom:1px solid var(--border);
      background:color-mix(in srgb, var(--bg), transparent 70%); backdrop-filter:saturate(140%) blur(6px);
      position:sticky; top:0; z-index:10;
    }
    .brand{ display:flex; align-items:center; gap:14px; }
    .logo{
      width:42px; height:42px; border-radius:50%;
      background:radial-gradient(circle at 30% 30%, #ffcf8a 0%, #ff8a3d 50%, #e05500 100%);
      border:2px solid #ffcf8a; position:relative; overflow:hidden;
      box-shadow:0 4px 12px rgba(255,122,24,0.25);
    }
    .logo:before{content:""; position:absolute; left:8px; top:12px; width:26px; height:18px; background:#221a10; border-radius:12px;}
    .logo:after{content:""; position:absolute; left:10px; top:16px; width:10px; height:6px; background:#ffcf8a; border-radius:6px;}
    .title{ display:flex; flex-direction:column; line-height:1.1; }
    .title h1{ margin:0; font-size:20px; letter-spacing:0.4px; }
    .title span{ color:var(--muted); font-size:12px; }
    .cta{ display:flex; gap:8px; align-items:center; }
    .badge{ padding:8px 12px; border:1px solid var(--border); border-radius:8px; color:var(--muted); font-size:12px; }
    .btn{
      background:var(--accent); color:#08090f; border:none; border-radius:8px; padding:10px 14px; font-weight:600; cursor:pointer;
      box-shadow:0 6px 16px rgba(255,122,24,0.35); transition: transform .06s ease;
    }
    .btn:active{ transform: scale(0.98); }
    .toggle{
      border:1px solid var(--border); background:var(--panel); color:var(--text); border-radius:8px; padding:10px 12px; cursor:pointer;
    }
    main{ padding:22px; max-width:1200px; margin:0 auto; }
    .grid{ display:grid; grid-template-columns:1.2fr 1fr; gap:22px; }

    /* Panel */
    .panel{
      background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:16px;
      box-shadow:0 12px 28px rgba(0,0,0,0.08);
    }
    .panel h2{ margin:0 0 12px; font-size:16px; color:color-mix(in srgb, var(--text), #bcd1ff 40%); letter-spacing:0.2px; }

    /* KPI Ticker */
    .ticker{
      display:flex; gap:12px; margin-left:18px;
    }
    .kpi{
      display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
      border:1px solid var(--border); background:color-mix(in srgb, var(--panel), transparent 20%);
      font-size:12px; color:var(--muted);
    }
    .kpi svg{ width:14px; height:14px; }

    /* Chat */
    .chat-header{
      display:flex; align-items:center; gap:12px; padding-bottom:12px; border-bottom:1px dashed var(--border);
    }
    .memo-avatar{
      width:46px; height:46px; border-radius:50%; background:radial-gradient(circle at 30% 30%, #ffcf8a 0%, #ff8a3d 55%, #db5a12 100%);
      border:2px solid #ffd7a6; position:relative;
    }
    .memo-avatar::before{ content:""; position:absolute; left:12px; top:14px; width:22px; height:16px; background:#1f140a; border-radius:10px; }
    .memo-avatar::after{ content:""; position:absolute; left:15px; top:18px; width:6px; height:6px; background:#ffcf8a; border-radius:50%; }
    .typing{ display:none; align-items:center; gap:6px; color:var(--text); font-size:12px; margin:8px 0 0 6px; opacity:.7; }
    .dot{ width:6px; height:6px; border-radius:50%; background:var(--text); opacity:0.3; animation: blink 1.2s infinite; }
    .dot:nth-child(2){ animation-delay: .2s; } .dot:nth-child(3){ animation-delay: .4s; }
    @keyframes blink { 0%{opacity:.2} 50%{opacity:1} 100%{opacity:.2} }
    .chat-area{ height:380px; overflow:auto; padding:12px; display:flex; flex-direction:column; gap:10px; }
    .msg{ max-width:80%; padding:10px 12px; border-radius:12px; font-size:14px; line-height:1.4; opacity:0; transform:translateY(6px); animation: slideIn .25s ease forwards; }
    @keyframes slideIn{ to{opacity:1; transform:translateY(0);} }
    .bot{ background:var(--card); border:1px solid var(--border); color:var(--text); }
    .user{ background:color-mix(in srgb, var(--blue), transparent 80%); border:1px solid color-mix(in srgb, var(--blue), #000 70%); color:var(--text); align-self:flex-end; }
    .system{ align-self:center; color:var(--muted); font-size:12px; padding:6px 10px; border:1px dashed var(--border); border-radius:10px; background:color-mix(in srgb, var(--panel), transparent 30%); }
    .quick-actions{ display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
    .chip{ padding:8px 10px; border:1px solid var(--border); border-radius:999px; font-size:12px; color:var(--text); cursor:pointer; background:var(--chip); }
    .chip svg{ width:14px; height:14px; margin-right:6px; vertical-align:middle; }

    /* Product cards */
    .cards{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:6px; }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:10px; padding:10px; }
    .card h4{ margin:0 0 6px; font-size:13px; color:var(--text); display:flex; align-items:center; gap:6px; }
    .price{ color:var(--green); font-weight:700; font-size:12px; }
    .card button{ margin-top:6px; width:100%; padding:8px; border-radius:8px; border:1px solid var(--border); background:color-mix(in srgb, var(--blue), transparent 80%); color:var(--text); cursor:pointer; font-size:12px; }

    /* Analytics */
    .stats{ display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
    .stat{ background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:12px; }
    .stat .label{ color:var(--muted); font-size:12px; }
    .stat .value{ font-size:24px; font-weight:700; margin-top:4px; transition: transform .15s ease; }
    .value.bump{ transform: scale(1.04); }
    .value.teal{ color:var(--blue); } .value.blue{ color:var(--blue); } .value.purple{ color:var(--purple); }
    .charts{ display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px; }
    canvas{ background:var(--card); border:1px solid var(--border); border-radius:12px; }

    /* Controls */
    .controls-grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .control{ background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:12px; }
    .control label{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
    .control select,.control input,.control textarea{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border); background:var(--card); color:var(--text); }

    /* Modal */
    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.35); }
    .modal .sheet{ width:92%; max-width:520px; background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:16px; color:var(--text); box-shadow:0 12px 28px rgba(0,0,0,0.25); }
    .sheet h3{ margin:0 0 8px; font-size:16px; color:color-mix(in srgb, var(--text), #bcd1ff 40%); }
    .sheet .row{ display:flex; gap:8px; }
    .sheet input, .sheet select{ flex:1; padding:10px; border-radius:10px; border:1px solid var(--border); background:var(--card); color:var(--text); }
    .sheet .actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:10px; }
    .sheet .actions .btn{ background:var(--green); color:#061014; box-shadow:0 6px 16px color-mix(in srgb, var(--green), transparent 60%); }

    /* Toasts */
    .toast{
      position:fixed; right:16px; bottom:16px; background:var(--panel); border:1px solid var(--border); color:var(--text);
      padding:10px 12px; border-radius:10px; box-shadow:0 10px 22px rgba(0,0,0,0.15); display:none;
    }

    /* Confetti canvas */
    #confetti{ position:fixed; inset:0; pointer-events:none; }

    /* Footer CTA */
    .value-box{ display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:12px; }
    .value-item{ background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:12px; }
    .value-item .big{ font-weight:700; color:var(--green); }
    .note{ color:var(--muted); font-size:12px; margin-top:8px; }

    /* Responsive */
    @media (max-width:1024px){
      .grid{ grid-template-columns:1fr; }
      .charts{ grid-template-columns:1fr; }
      .stats{ grid-template-columns:1fr 1fr; }
      .cards{ grid-template-columns:repeat(2,1fr); }
    }
    @media (max-width:640px){
      header{ flex-wrap:wrap; gap:10px; }
      .stats{ grid-template-columns:1fr; }
      .value-box{ grid-template-columns:1fr; }
      .cards{ grid-template-columns:1fr; }
    }
  </style>
</head>
<body data-theme="dark">
  <canvas id="confetti"></canvas>

  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div class="title">
        <h1>Market.Me24 â€” Interactive Demo Dashboard</h1>
        <span>GINI you fly â€¢ Presented by Eng. Maher Fekri</span>
      </div>
      <div class="ticker">
        <div class="kpi"><svg viewBox="0 0 24 24" fill="none"><path d="M5 12l4 4 10-10" stroke="currentColor" stroke-width="2"/></svg> Live</div>
        <div class="kpi"><svg viewBox="0 0 24 24" fill="none"><path d="M4 4h16v16H4z" stroke="currentColor" stroke-width="2"/></svg> Web â€¢ Telegram</div>
      </div>
    </div>
    <div class="cta">
      <button class="toggle" id="themeToggle">Theme: Dark</button>
      <span class="badge">Interactive â€¢ Exportable</span>
      <button class="btn" id="bookDemoBtn">Book demo</button>
    </div>
  </header>

  <main>
    <div class="grid">
      <!-- Chat Panel -->
      <section class="panel" id="chatPanel">
        <div class="chat-header">
          <div class="memo-avatar" aria-hidden="true"></div>
          <div>
            <h2>Live bot preview â€” Memo78</h2>
            <span style="font-size:12px; color:var(--muted);">Brand: Market.Me24 â€¢ Persona: <span id="personaLabel">Friendly</span></span>
            <div class="typing" id="typing"><span>Memo78 is typing</span><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
          </div>
        </div>

        <div class="chat-area" id="chatArea">
          <div class="system">Welcome to Market.Me24 â€” GINI you fly</div>
          <div class="bot" id="greetingBubble">Hi there ðŸ‘‹ Iâ€™m Memo78. How can I help you today?</div>
        </div>

        <div class="quick-actions">
          <div class="chip" data-msg="Show me products">
            <svg viewBox="0 0 24 24" fill="none"><path d="M3 7h18M3 12h18M3 17h18" stroke="currentColor" stroke-width="2"/></svg>
            Show me products
          </div>
          <div class="chip" data-msg="Pricing">
            <svg viewBox="0 0 24 24" fill="none"><path d="M12 1v22M1 12h22" stroke="currentColor" stroke-width="2"/></svg>
            Pricing
          </div>
          <div class="chip" data-msg="Book a call">
            <svg viewBox="0 0 24 24" fill="none"><path d="M7 2v4M17 2v4M3 8h18v12H3z" stroke="currentColor" stroke-width="2"/></svg>
            Book a call
          </div>
          <div class="chip" data-msg="Track my order">
            <svg viewBox="0 0 24 24" fill="none"><path d="M3 7h13v10H3zM16 10h5l-2-3h-3z" stroke="currentColor" stroke-width="2"/></svg>
            Track my order
          </div>
          <div class="chip" data-msg="Get an offer">
            <svg viewBox="0 0 24 24" fill="none"><path d="M4 4h16v12H4zM4 16l4 4h8l4-4" stroke="currentColor" stroke-width="2"/></svg>
            Get an offer
          </div>
        </div>

        <div class="chat-input">
          <input id="chatInput" placeholder="Type a message..." />
          <button id="sendBtn" class="toggle">Send</button>
        </div>
      </section>

      <!-- Analytics Panel -->
      <section class="panel">
        <h2>Analytics</h2>
        <div class="stats">
          <div class="stat">
            <div class="label">Conversations</div>
            <div class="value teal" id="convValue">0</div>
          </div>
          <div class="stat">
            <div class="label">Leads captured</div>
            <div class="value blue" id="leadsValue">0</div>
          </div>
          <div class="stat">
            <div class="label">Positive sentiment</div>
            <div class="value purple" id="sentValue">86%</div>
          </div>
        </div>
        <div class="charts">
          <canvas id="sentChart" width="420" height="220"></canvas>
          <canvas id="convChart" width="420" height="220"></canvas>
        </div>
        <div class="value-box">
          <div class="value-item">
            <div class="big">Save 10+ hours/week</div>
            <div class="note">Automate FAQs, order tracking, and lead capture.</div>
          </div>
          <div class="value-item">
            <div class="big">Boost engagement ~35%</div>
            <div class="note">Branded conversations increase response rates.</div>
          </div>
          <div class="value-item">
            <div class="big">Deploy in minutes</div>
            <div class="note">Telegram, WhatsApp, and web-ready flows.</div>
          </div>
        </div>
      </section>
    </div>

    <!-- Controls -->
    <section class="panel" style="margin-top:22px;">
      <h2>Control panel</h2>
      <div class="controls-grid">
        <div class="control">
          <label for="personaSelect">Bot personality</label>
          <select id="personaSelect">
            <option>Friendly</option>
            <option>Professional</option>
            <option>Playful</option>
          </select>
        </div>
        <div class="control">
          <label for="greetingInput">Greeting message</label>
          <input id="greetingInput" value="Hi there ðŸ‘‹ Iâ€™m Memo78. How can I help you today?" />
        </div>
        <div class="control">
          <label>Exports</label>
          <div class="row" style="display:flex; gap:8px;">
            <button class="btn" id="exportCsvBtn">Export CSV</button>
            <button class="btn" id="exportPdfBtn" style="background:var(--purple); color:#0a0b12; box-shadow:0 6px 16px rgba(122,76,255,0.35);">Export PDF</button>
          </div>
        </div>
        <div class="control">
          <label>Shortcuts</label>
          <div class="row" style="display:flex; gap:8px;">
            <button id="resetDemoBtn" class="btn" style="background:var(--green); color:#061014;">Reset demo</button>
            <button id="contactBtn" class="toggle">WhatsApp Eng. Maher</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <section class="panel" style="margin-top:22px;">
      <h2>Client-ready highlights</h2>
      <ul style="list-style: none; padding:0; margin:0;">
        <li class="system">Brand: Market.Me24 â€¢ Tagline: GINI you fly â€¢ Signature authority: Eng. Maher Fekri</li>
        <li class="system">Mobile: +971 555 231 060 â€¢ Email: maher.fekri1978@gmail.com</li>
        <li class="system">Share this live demo link in proposals and meetings to build instant credibility.</li>
      </ul>
    </section>
  </main>

  <!-- Booking Modal -->
  <div class="modal" id="bookingModal" aria-hidden="true">
    <div class="sheet">
      <h3>Book a call â€” Market.Me24</h3>
      <div class="row">
        <input type="date" id="bookDate" />
        <select id="bookTime">
          <option value="">Select time</option>
          <option>10:00</option><option>11:00</option><option>12:00</option>
          <option>14:00</option><option>16:00</option><option>18:00</option>
        </select>
      </div>
      <div class="row" style="margin-top:8px;">
        <input type="text" id="bookName" placeholder="Your name" />
        <input type="email" id="bookEmail" placeholder="Email" />
      </div>
      <div class="actions">
        <button class="btn" id="confirmBookingBtn">Confirm</button>
        <button class="btn" style="background:var(--blue);" id="closeBookingBtn">Close</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // Theme toggle
    const themeToggle = document.getElementById('themeToggle');
    function setTheme(next){
      document.body.setAttribute('data-theme', next);
      themeToggle.textContent = `Theme: ${next[0].toUpperCase()+next.slice(1)}`;
    }
    themeToggle.addEventListener('click', ()=>{
      const cur = document.body.getAttribute('data-theme');
      setTheme(cur === 'dark' ? 'light' : 'dark');
    });

    // Elements
    const chatArea = document.getElementById('chatArea');
    const input = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    const chips = document.querySelectorAll('.chip');
    const convValue = document.getElementById('convValue');
    const leadsValue = document.getElementById('leadsValue');
    const sentValue = document.getElementById('sentValue');
    const personaSelect = document.getElementById('personaSelect');
    const personaLabel = document.getElementById('personaLabel');
    const greetingInput = document.getElementById('greetingInput');
    const greetingBubble = document.getElementById('greetingBubble');
    const exportCsvBtn = document.getElementById('exportCsvBtn');
    const exportPdfBtn = document.getElementById('exportPdfBtn');
    const resetDemoBtn = document.getElementById('resetDemoBtn');
    const contactBtn = document.getElementById('contactBtn');
    const bookDemoBtn = document.getElementById('bookDemoBtn');
    const typing = document.getElementById('typing');
    const toast = document.getElementById('toast');

    // Booking modal
    const bookingModal = document.getElementById('bookingModal');
    const bookDate = document.getElementById('bookDate');
    const bookTime = document.getElementById('bookTime');
    const bookName = document.getElementById('bookName');
    const bookEmail = document.getElementById('bookEmail');
    const confirmBookingBtn = document.getElementById('confirmBookingBtn');
    const closeBookingBtn = document.getElementById('closeBookingBtn');

    // Confetti
    const confettiCanvas = document.getElementById('confetti');
    const cctx = confettiCanvas.getContext('2d');
    let confettiPieces = [];
    function resizeConfetti(){ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
    window.addEventListener('resize', resizeConfetti); resizeConfetti();
    function launchConfetti(){
      confettiPieces = Array.from({length: 120}).map(()=>({
        x: Math.random()*confettiCanvas.width,
        y: -10,
        r: 3+Math.random()*4,
        c: ['#ff7a18','#41d67a','#3ec2ff','#b071ff'][Math.floor(Math.random()*4)],
        vy: 2+Math.random()*3, vx: (Math.random()-0.5)*2, rot: Math.random()*Math.PI
      }));
      let t=0; const anim = ()=>{
        t++; cctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
        confettiPieces.forEach(p=>{
          p.x += p.vx; p.y += p.vy; p.rot += 0.05;
          cctx.save(); cctx.translate(p.x,p.y); cctx.rotate(p.rot);
          cctx.fillStyle = p.c; cctx.fillRect(-p.r, -p.r, p.r*2, p.r*2); cctx.restore();
        });
        if(t<200) requestAnimationFrame(anim); else confettiPieces = [];
      };
      anim();
    }

    // State
    let conversations = 0;
    let leads = 0;
    let sentiment = 86; // %
    let chatLog = [];   // {role, text, ts}
    let awaitingOrderId = false;

    // Charts
    const sentCtx = document.getElementById('sentChart').getContext('2d');
    const convCtx = document.getElementById('convChart').getContext('2d');
    let convHistory = Array(24).fill(0);

    // Smooth update helpers
    function bump(el){
      el.classList.add('bump');
      setTimeout(()=> el.classList.remove('bump'), 160);
    }

    function drawSentimentChart(value){
      const ctx = sentCtx, w = ctx.canvas.width, h = ctx.canvas.height;
      ctx.clearRect(0,0,w,h);
      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--card');
      ctx.fillRect(0,0,w,h);
      const cx = w/2, cy = h/2, r = 70;
      const start = -Math.PI/2;
      const sweep = (value/100)*Math.PI*2;
      // Background ring
      ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2);
      ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--border'); ctx.lineWidth=20; ctx.stroke();
      // Value ring
      const grad = ctx.createLinearGradient(0,0,w,0);
      grad.addColorStop(0,getComputedStyle(document.body).getPropertyValue('--green').trim());
      grad.addColorStop(1,getComputedStyle(document.body).getPropertyValue('--blue').trim());
      ctx.beginPath(); ctx.arc(cx,cy,r,start,start+sweep); ctx.strokeStyle = grad; ctx.lineWidth=20; ctx.lineCap='round'; ctx.stroke();
      // Text
      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--text'); ctx.font = '700 22px Inter';
      ctx.textAlign='center'; ctx.fillText(Math.round(value)+'% positive', cx, cy+8);
      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--muted'); ctx.font='12px Inter';
      ctx.fillText('Sentiment (simulated)', cx, cy+28);
    }

    function drawConvChart(history){
      const ctx = convCtx, w = ctx.canvas.width, h = ctx.canvas.height;
      ctx.clearRect(0,0,w,h);
      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--card'); ctx.fillRect(0,0,w,h);
      // Axes
      const border = getComputedStyle(document.body).getPropertyValue('--border');
      ctx.strokeStyle=border; ctx.lineWidth=1.2;
      ctx.beginPath(); ctx.moveTo(40, h-30); ctx.lineTo(w-12, h-30); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(40, 20); ctx.lineTo(40, h-30); ctx.stroke();
      // Line
      const max = Math.max(10, ...history);
      const scaleX = (w-60)/history.length;
      const scaleY = (h-60)/max;
      ctx.beginPath(); ctx.lineWidth=2; ctx.strokeStyle=getComputedStyle(document.body).getPropertyValue('--purple').trim();
      history.forEach((v,i)=>{
        const x = 40 + i*scaleX;
        const y = h-30 - v*scaleY;
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.stroke();
      ctx.fillStyle=getComputedStyle(document.body).getPropertyValue('--text'); ctx.font='700 16px Inter'; ctx.textAlign='left';
      ctx.fillText('Conversations (last minute)', 46, 28);
    }

    function toastShow(msg){
      toast.textContent = msg;
      toast.style.display = 'block';
      setTimeout(()=> toast.style.display = 'none', 1800);
    }

    function appendMsg(role, text, html=false){
      const el = document.createElement('div');
      if(role==='system'){
        el.className = 'system';
        el.textContent = text;
      } else {
        el.className = role === 'user' ? 'msg user' : 'msg bot';
        if(html){ el.innerHTML = text; } else { el.textContent = text; }
      }
      chatArea.appendChild(el);
      chatArea.scrollTop = chatArea.scrollHeight;
      chatLog.push({role, text: el.textContent, ts: new Date().toISOString()});
    }

    function personaStyle(text){
      const p = personaSelect.value;
      if(p==='Friendly') return text + ' ðŸ˜Š';
      if(p==='Professional') return text.replace(/!+/g, '.');
      if(p==='Playful') return text + ' âœ¨';
      return text;
    }

    function showTyping(show){ typing.style.display = show ? 'flex' : 'none'; }

    function showProductCards(){
      const icon = '<svg viewBox="0 0 24 24" fill="none" style="width:14px;height:14px;"><path d="M3 7h18M3 12h18M3 17h18" stroke="currentColor" stroke-width="2"/></svg>';
      const cardsHtml = `
        <div class="cards">
          <div class="card">
            <h4>${icon} Starter Bot</h4>
            <div class="price">$99 setup</div>
            <button class="buy-btn" data-plan="Starter">Get offer</button>
          </div>
          <div class="card">
            <h4>${icon} Pro Bot</h4>
            <div class="price">$199 + analytics</div>
            <button class="buy-btn" data-plan="Pro">Get offer</button>
          </div>
          <div class="card">
            <h4>${icon} Custom Bot</h4>
            <div class="price">$299+ full branding</div>
            <button class="buy-btn" data-plan="Custom">Get offer</button>
          </div>
        </div>
      `;
      appendMsg('bot', `<div>Hereâ€™s a quick catalog preview. Choose a plan to proceed:</div>${cardsHtml}`, true);
      setTimeout(()=>{
        document.querySelectorAll('.buy-btn').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            leads++; leadsValue.textContent = leads; bump(leadsValue);
            sentiment = Math.min(100, sentiment + 1.2); sentValue.textContent = Math.round(sentiment)+'%'; bump(sentValue); drawSentimentChart(sentiment);
            appendMsg('user', `I want the ${btn.dataset.plan} plan`);
            showTyping(true);
            setTimeout(()=>{
              showTyping(false);
              appendMsg('bot', personaStyle(`Excellent choice. Iâ€™ll prepare an offer for the ${btn.dataset.plan} plan. Please confirm your email.`));
              toastShow(`Offer initiated: ${btn.dataset.plan} plan`);
            }, 500);
          });
        });
      }, 50);
    }

    function openBookingModal(){ bookingModal.style.display = 'flex'; }
    function closeBookingModal(){ bookingModal.style.display = 'none'; bookDate.value = ''; bookTime.value = ''; bookName.value = ''; bookEmail.value = ''; }

    function botReply(userText){
      const lower = userText.toLowerCase();

      if(awaitingOrderId){
        const id = userText.trim(); awaitingOrderId = false;
        showTyping(true);
        setTimeout(()=>{
          showTyping(false);
          appendMsg('bot', personaStyle(`Order ${id} is in transit ðŸšš â€” expected delivery in 2 days.`));
          sentiment = Math.min(100, sentiment + 1.0); sentValue.textContent = Math.round(sentiment)+'%'; bump(sentValue); drawSentimentChart(sentiment);
          toastShow(`Order ${id}: status updated`);
        }, 600);
        return;
      }

      let reply = ''; let special = null;

      if(lower.includes('product')){
        special = 'catalog'; reply = 'Let me show you our popular plans.';
      } else if(lower.includes('price') || lower.includes('pricing')){
        reply = 'Starter $99 â€¢ Pro $199 (analytics) â€¢ Custom $299+ (full branding). Shall I prepare an offer?';
      } else if(lower.includes('book')){
        special = 'booking'; reply = 'Letâ€™s book a call. Pick a date and time.';
      } else if(lower.includes('track')){
        awaitingOrderId = true; reply = 'Please share your order ID, and Iâ€™ll fetch the latest status.';
      } else if(lower.includes('offer')){
        special = 'offer'; reply = 'Offer prepared. I can generate a branded summary now.';
      } else {
        reply = 'I can help with products, pricing, booking, and tracking. What do you need?';
      }

      reply = personaStyle(reply);
      appendMsg('bot', reply);

      // Metrics
      conversations++; convValue.textContent = conversations; bump(convValue);
      convHistory.shift(); convHistory.push(Math.max(0, Math.round(Math.random()*4)+1));
      drawConvChart(convHistory);

      if(lower.includes('offer') || lower.includes('book')){
        leads++; leadsValue.textContent = leads; bump(leadsValue);
        sentiment = Math.min(100, sentiment + 0.8);
      } else {
        sentiment = Math.max(60, sentiment + (Math.random()*2-0.8));
      }
      sentValue.textContent = Math.round(sentiment) + '%'; bump(sentValue); drawSentimentChart(sentiment);

      // Specials
      if(special==='catalog'){ showTyping(true); setTimeout(()=>{ showTyping(false); showProductCards(); }, 600); }
      if(special==='booking'){ openBookingModal(); }
      if(special==='offer'){
        showTyping(true);
        setTimeout(()=>{
          showTyping(false);
          appendMsg('bot', personaStyle('Offer ready: exporting a branded summary. You can print or save as PDF.'));
          toastShow('Branded offer ready to export');
        }, 800);
      }
    }

    // Send handlers
    sendBtn.addEventListener('click', ()=>{
      const text = input.value.trim(); if(!text) return;
      appendMsg('user', text); input.value='';
      showTyping(true);
      setTimeout(()=> { showTyping(false); botReply(text); }, 500);
    });
    input.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ sendBtn.click(); } });
    chips.forEach(c=> c.addEventListener('click', ()=>{
      const t = c.getAttribute('data-msg');
      appendMsg('user', t);
      showTyping(true);
      setTimeout(()=> { showTyping(false); botReply(t); }, 450);
    }));

    // Controls
    personaSelect.addEventListener('change', ()=>{ personaLabel.textContent = personaSelect.value; toastShow(`Persona: ${personaSelect.value}`); });
    greetingInput.addEventListener('input', ()=>{ greetingBubble.textContent = greetingInput.value; });

    // Export CSV
    exportCsvBtn.addEventListener('click', ()=>{
      const rows = [['role','text','timestamp']].concat(chatLog.map(r=>[r.role, r.text.replace(/\n/g,' '), r.ts]));
      const csv = rows.map(r=> r.map(v=> `"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'marketme24_demo_chat.csv'; a.click();
      URL.revokeObjectURL(a.href); toastShow('Chat exported (CSV)');
    });

    // Export PDF (print)
    exportPdfBtn.addEventListener('click', ()=> { window.print(); toastShow('Print dialog opened (PDF)'); });

    // Reset demo
    resetDemoBtn.addEventListener('click', ()=>{
      conversations = 0; leads = 0; sentiment = 86; chatLog = []; awaitingOrderId = false;
      convValue.textContent = conversations; leadsValue.textContent = leads; sentValue.textContent = Math.round(sentiment)+'%';
      chatArea.innerHTML = '';
      appendMsg('system','Welcome to Market.Me24 â€” GINI you fly');
      greetingBubble.textContent = greetingInput.value; chatArea.appendChild(greetingBubble);
      convHistory = Array(24).fill(0); drawConvChart(convHistory); drawSentimentChart(sentiment);
      toastShow('Demo reset'); 
    });

    // Book demo CTA increments leads
    bookDemoBtn.addEventListener('click', ()=>{
      leads++; leadsValue.textContent = leads; bump(leadsValue);
      appendMsg('system','Demo request recorded. Our team will reach out shortly.');
      sentiment = Math.min(100, sentiment + 1.5); sentValue.textContent = Math.round(sentiment)+'%'; bump(sentValue); drawSentimentChart(sentiment);
      toastShow('Demo request sent');
    });

    // WhatsApp contact
    contactBtn.addEventListener('click', ()=>{
      const phone = '971555231060';
      const msg = encodeURIComponent('Hello Eng. Maher â€” Iâ€™d like to discuss Market.Me24 bots (GINI you fly).');
      window.open(`https://wa.me/${phone}?text=${msg}`, '_blank');
      toastShow('Opening WhatsAppâ€¦');
    });

    // Booking modal handlers
    confirmBookingBtn.addEventListener('click', ()=>{
      const d = bookDate.value, t = bookTime.value, n = bookName.value.trim(), e = bookEmail.value.trim();
      if(!d || !t || !n || !e){ appendMsg('system','Please fill date, time, name, and email to confirm.'); return; }
      closeBookingModal();
      leads++; leadsValue.textContent = leads; bump(leadsValue);
      showTyping(true);
      setTimeout(()=>{
        showTyping(false);
        appendMsg('bot', personaStyle(`Great, ${n}. Your call is booked for ${d} at ${t}. A confirmation will be sent to ${e}.`));
        sentiment = Math.min(100, sentiment + 1.2); sentValue.textContent = Math.round(sentiment)+'%'; bump(sentValue); drawSentimentChart(sentiment);
        toastShow('Booking confirmed'); launchConfetti();
      }, 700);
    });
    closeBookingBtn.addEventListener('click', closeBookingModal);
    bookingModal.addEventListener('click', (e)=> { if(e.target===bookingModal) closeBookingModal(); });

    // Auto simulation tick (keeps charts alive)
    setInterval(()=>{
      const delta = Math.random()<0.35 ? 1 : 0;
      convHistory.shift(); convHistory.push(Math.max(0, (convHistory[convHistory.length-1] + delta)));
      drawConvChart(convHistory);
      sentiment = Math.max(60, Math.min(98, sentiment + (Math.random()*1.2-0.4)));
      sentValue.textContent = Math.round(sentiment)+'%'; drawSentimentChart(sentiment);
    }, 2500);

    // Init
    (function init(){
      setTheme('dark');
      drawSentimentChart(sentiment);
      drawConvChart(convHistory);
      appendMsg('system','Type a message, use quick actions, or try booking a call to see the demo in action.');
    })();
  </script>
</body>
</html>
